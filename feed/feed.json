{
	"version": "https://jsonfeed.org/version/1.1",
	"title": "Hypersphere",
	"language": "en",
	"home_page_url": "https://hypersphere.codes/",
	"feed_url": "https://hypersphere.codes/feed/feed.json",
	"description": "Tech blog, mostly about TypeScript",
	"author": {
		"name": "Kacper Kula",
		"url": "https://github.com/kulak-at"
	},
	"items": [
		{
			"id": "https://hypersphere.codes/blog/randomness-in-css-using-trigonometry/",
			"url": "https://hypersphere.codes/blog/randomness-in-css-using-trigonometry/",
			"title": "Randomness in CSS using trigonometry",
			"content_html": "<script async=\"\" src=\"https://cpwebassets.codepen.io/assets/embed/ei.js\"></script>\n<p>In the past, <a href=\"https://medium.com/hypersphere-codes/randomness-in-css-b55a0845c8dd\">I have covered the topic of randomness in CSS using modulo operation</a> and I <a href=\"https://medium.com/hypersphere-codes/counting-in-css-unlock-magic-of-css-variables-8e610881097a\">used prime numbers to create an automatic counter that can be used to generate different values for each object</a>. Thanks to that, we could compute pseudo-random values for each element independently.</p>\n<p>As robust as this solution is, it has few downsides:</p>\n<ul>\n<li>The modulo function is not continuous</li>\n<li>It is overly complex: requires 3 variables and <code>@property</code> definition for each random value we want to generate</li>\n<li>Requires using <code>@property</code> which is not widely supported yet</li>\n</ul>\n<p>Fortunately, we can do better! In this article, I would like to propose a better solution using trigonometry.</p>\n<h2 id=\"better-approach\" tabindex=\"-1\">Better approach <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/randomness-in-css-using-trigonometry/\">#</a></h2>\n<p>Since the last time I explored this topic, new amazing features arrived in CSS. One of the most exciting additions is the trigonometric functions. They unlock a lot of previously impossible tasks. They are also the first bounded continuous functions natively supported in CSS, making them an amazing tool for creating pseudo-random generators.</p>\n<h2 id=\"characteristics-of-a-sine-function\" tabindex=\"-1\">Characteristics of a sine¬†function <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/randomness-in-css-using-trigonometry/\">#</a></h2>\n<p>Sine and cosine functions are interesting for many reasons. They can be very useful in all sorts of operations where circles and rotations are involved. In our case though, we can use their properties for other purposes.</p>\n<h3 id=\"bounded-function\" tabindex=\"-1\">Bounded function <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/randomness-in-css-using-trigonometry/\">#</a></h3>\n<p>One of the great properties of sine and cosine is that the resulting values are always bounded between -1 and 1. It means, no matter how big or small the value you pass to it, the result will always be a value from this range.¬†Then, we can perform simple normalisation to the range <code>[0,1]</code>. Having normalised values, we can use it to represent any value using simple linear mapping.</p>\n<pre class=\"language-css\" tabindex=\"0\"><code class=\"language-css\"><span class=\"token property\">--x</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.5 + 0.5 * <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--n<span class=\"token punctuation\">)</span> * 342.06184 + 23.434<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* Then we can use it as following */</span>\n<span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgb</span><span class=\"token punctuation\">(</span><span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>50 + <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--x<span class=\"token punctuation\">)</span> * 100<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">,</span> 0<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n/* Red will be in the range of 50-150.</code></pre>\n<p>The code above uses our counter <code>var(--n)</code> introduced in my past article where I use prime numbers to create an effective way to automatically create a counter variable in CSS.</p>\n<a class=\"article-link\" href=\"https://medium.com/hypersphere-codes/counting-in-css-unlock-magic-of-css-variables-8e610881097a\">\n    <img src=\"https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ASL8jncpPqtsOV-BVqxHnQ.png\">\n    <div class=\"details\">\n        <div class=\"link-title\">Counting in CSS: Unlock magic of CSS variables</div>\n        <p>Use prime numbers to create generic counters in CSS that you can use for all sorts of stuff.</p>\n        <div class=\"link-url\">medium.com/hypersphere-codes/counting-in-css-unlock-magic-of-css-variables-8e610881097a</div>\n    </div>\n</a>\n<p>The value is then multiplied and offset by some arbitrary values to provide a pseudo-random big number (the values do not really matter, you can change them as you wish to get different results). After that, we use the sine function to map it to the range <code>[-1, 1]</code>. Lastly, as shown in the animation below, we can map it to the range <code>[0, 1]</code> by applying a simple algebraic transformation. Once we obtain value from the range <code>[0, 1]</code>, we can use linear mapping to map it to any other desired value.</p>\n<img src=\"https://hypersphere.codes/blog/randomness/scaling.gif\" alt=\"Visualisation of Scaling\">\n<h3 id=\"continuity\" tabindex=\"-1\">Continuity <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/randomness-in-css-using-trigonometry/\">#</a></h3>\n<p>Another characteristic of the sine function is continuity. You can <a href=\"https://en.wikipedia.org/wiki/Continuous_function\">explore the full formal definition of continuity here</a>, but to make things simple you can think of it that the small changes in the input for sine or cosine function will end up in small changes to the output. Thanks to that we can achieve a gradual change in values when animating while still having the system behave randomly.</p>\n<img src=\"https://hypersphere.codes/blog/randomness/continuity.gif\" alt=\"Visualisation of Continuity\">\n<h2 id=\"examples\" tabindex=\"-1\">Examples <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/randomness-in-css-using-trigonometry/\">#</a></h2>\n<p>Here are a few examples demonstrating the potential of using trigonometric functions to generate pseudo-random values.</p>\n<h3 id=\"circles-grid\" tabindex=\"-1\">Circles Grid <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/randomness-in-css-using-trigonometry/\">#</a></h3>\n<p>The first example shows sine properties in action. The generated values are random but we can still maintain order and feeling of continuity when it comes to both colour and size animation.</p>\n<p class=\"codepen\" data-height=\"600\" data-default-tab=\"result\" data-slug-hash=\"QWJBOgG\" data-user=\"hypersphere\" style=\"height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;\">\n  <span>See the Pen <a href=\"https://codepen.io/hypersphere/pen/QWJBOgG\">\n  Randomness in CSS using Trigonomentry</a> by hypersphere (<a href=\"https://codepen.io/hypersphere\">@hypersphere</a>)\n  on <a href=\"https://codepen.io\">CodePen</a>.</span>\n</p>\n<p>They key part of the code is computation of x, y, z and w variables which are used to represent red, green, blue and width respectively.</p>\n<pre class=\"language-css\" tabindex=\"0\"><code class=\"language-css\"><span class=\"token selector\">div::before</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">--x</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.5 + 0.5 * <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>4.284 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">--y</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.5 + 0.5 * <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>7.284 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">--z</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.5 + 0.5 * <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>4 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--n<span class=\"token punctuation\">)</span> + 2 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">--w</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.5 + 0.5 * <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>0.2 * <span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--t<span class=\"token punctuation\">)</span>/100<span class=\"token punctuation\">)</span> + 0.8<span class=\"token punctuation\">)</span> * 49.123 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--n<span class=\"token punctuation\">)</span> + <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token function\">rgb</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>50 +  100 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>200 + 30 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--y<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>120 + 100 * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--z<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>50% + <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--w<span class=\"token punctuation\">)</span>*50%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>The last 2 variables, in addition to our counter <code>--n</code>, use time variable <code>--t</code> which is obtained by running animation that is changing gradually the variable:</p>\n<pre class=\"language-css\" tabindex=\"0\"><code class=\"language-css\"><span class=\"token atrule\"><span class=\"token rule\">@property</span> --t</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">syntax</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'&lt;number>'</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">/* &lt;- defined as type number for the transition to work */</span>\n  <span class=\"token property\">initial-value</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">inherits</span><span class=\"token punctuation\">:</span> true<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\">:root</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">--t</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token atrule\"><span class=\"token rule\">@keyframes</span> timeOn</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token selector\">50%</span> <span class=\"token punctuation\">{</span><span class=\"token property\">--t</span><span class=\"token punctuation\">:</span> 30<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">html</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">animation</span><span class=\"token punctuation\">:</span> 30s timeOn infinite linear<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>This is the only part of the code that uses <code>@property</code>. To make it work in all browsers, we could just simply update this variable in JavaScript without losing the ability to compute everything else in plain CSS.</p>\n<h3 id=\"blobs\" tabindex=\"-1\">Blobs <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/randomness-in-css-using-trigonometry/\">#</a></h3>\n<p>Randomness can be also used with SVG elements making it a powerful tool when combined with SVG Filters. The demo below was inspired by an <a href=\"https://css-tricks.com/gooey-effect/\">amazing CSS-Tricks article The Gooey Effect</a>.</p>\n<p class=\"codepen\" data-height=\"629.1723022460938\" data-default-tab=\"result\" data-slug-hash=\"oNQPYWW\" data-user=\"hypersphere\" style=\"height: 629.1723022460938px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;\">\n  <span>See the Pen <a href=\"https://codepen.io/hypersphere/pen/oNQPYWW\">\n  Randomness in CSS with Trigonometry using SVG circles</a> by hypersphere (<a href=\"https://codepen.io/hypersphere\">@hypersphere</a>)\n  on <a href=\"https://codepen.io\">CodePen</a>.</span>\n</p>\n<p>Position of each individual blobs is determined using simple formula. The only difference is that we use cx, cy, r and fill to style them as they are SVG elements.</p>\n<pre class=\"language-css\" tabindex=\"0\"><code class=\"language-css\"><span class=\"token selector\">.blobs > circle</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">--x</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--t<span class=\"token punctuation\">)</span> + <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--n<span class=\"token punctuation\">)</span> * 74.543 + 432.43312<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">--y</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--t<span class=\"token punctuation\">)</span> + <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--n<span class=\"token punctuation\">)</span> * 2.34 + 1.432<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">--v</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>0.5 + 0.5 * <span class=\"token function\">sin</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--n<span class=\"token punctuation\">)</span> * <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--n<span class=\"token punctuation\">)</span> * 4.343 + 2.673<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token property\">cx</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>10vw + <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--x<span class=\"token punctuation\">)</span> * 80vw<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">cy</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>10vh + <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--y<span class=\"token punctuation\">)</span> * 80vh<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">r</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--v<span class=\"token punctuation\">)</span> * 5vw + 1vw<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>To achieve the gooey effect, we use the following SVG filter:</p>\n<pre class=\"language-html\" tabindex=\"0\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>filter</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>goo<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>feGaussianBlur</span> <span class=\"token attr-name\">in</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>SourceGraphic<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">result</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>blur<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">stdDeviation</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>15<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>feColorMatrix</span> <span class=\"token attr-name\">in</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>blur<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>matrix<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">values</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 22 -11<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">result</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>goo<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>feBlend</span> <span class=\"token attr-name\">in2</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>goo<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">in</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>SourceGraphic<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">result</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mix<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>filter</span><span class=\"token punctuation\">></span></span></code></pre>\n<h3 id=\"memphis-pattern\" tabindex=\"-1\">Memphis Pattern <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/randomness-in-css-using-trigonometry/\">#</a></h3>\n<p>The last demo is an <a href=\"https://medium.com/hypersphere-codes/randomness-in-css-b55a0845c8dd\">updated version of the example I used in my previous attempt for achieving randomness in CSS</a> where I used the modulo operator. With the new solution, calculations are much easier to understand and modify.</p>\n<p class=\"codepen\" data-height=\"589.572509765625\" data-default-tab=\"result\" data-slug-hash=\"yLQqGYj\" data-user=\"hypersphere\" style=\"height: 589.572509765625px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;\">\n  <span>See the Pen <a href=\"https://codepen.io/hypersphere/pen/yLQqGYj\">\n  Memphis Pattern using Trigonometry randomness</a> by hypersphere (<a href=\"https://codepen.io/hypersphere\">@hypersphere</a>)\n  on <a href=\"https://codepen.io\">CodePen</a>.</span>\n</p>\n<hr>\n<p>This article is also <a href=\"https://medium.com/hypersphere-codes/randomness-in-css-with-trigonometry-functions-fac71c89cd23\">available on my Medium Blog</a>. If you enjoy it, consider heading there and following me for more content.</p>\n",
			"date_published": "2023-07-31T00:00:00Z"
		}
		,
		{
			"id": "https://hypersphere.codes/blog/gameboy-like-app-in-13k/",
			"url": "https://hypersphere.codes/blog/gameboy-like-app-in-13k/",
			"title": "How I created a GameBoy-like game in 13kb",
			"content_html": "<!-- <img alt=\"Article Cover\" loading=\"lazy\" decoding=\"async\" style=\"aspect-ratio: 1.694915254237288\" width=\"2000\" height=\"1180\" src=\"/img/TwPZntxLeN-2000.webp\"> -->\n<p>This year I decided to participate in the js13kgames game jam. It‚Äôs a yearly, month-long competition to create a game in JavaScript from scratch that will fit 13kb (zipped). It does not sound like plenty of space, but with enough creativity, a lot can be achieved. Just look at those amazing examples from the past years:</p>\n<ul>\n<li><a href=\"https://js13kgames.com/entries/underrun\">Underrun</a> (winner in 2018)</li>\n<li><a href=\"https://js13kgames.com/entries/ninja-vs-evilcorp\">Ninja vs Evil-corp</a> (winner in 2020)</li>\n<li><a href=\"https://js13kgames.com/entries/beat-rocks\">Beat Rocks</a> (2nd place in 2021)</li>\n</ul>\n<p>Even though my game did not rank high this year, I still want to share some discoveries I‚Äôve made along my journey.</p>\n<p>For this year‚Äôs entry, I decided to create a game that evokes the retro era of handheld games, with its unique square form factor, low resolution, and top-down graphics. For the gameplay, I‚Äôve wanted it to be a fast-paced action-RPG style, with easy but addictive gameplay that encourages you to continue playing. The music choice was obvious ‚Äî sound effects must feel like taken directly from the arcades.</p>\n<p>If you want to play the game, you can do it on <a href=\"https://js13kgames.com/entries/gravepassing\">the Gravepassing JS13KGames entry page</a>. The full code is <a href=\"https://github.com/h-sphere/gravepassing\">available on GitHub</a>.</p>\n<p>In this article I would like to describe my journey and the different components and challenges I faced along the way:</p>\n<ul>\n<li>Inspirations</li>\n<li>Drawing graphics using emojis</li>\n<li>Dithering effect</li>\n<li>Object storage using Quad Tree</li>\n<li>Music</li>\n<li>Compression</li>\n</ul>\n<h2 id=\"inspirations-and-graphics\" tabindex=\"-1\">Inspirations and graphics <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/gameboy-like-app-in-13k/\">#</a></h2>\n<p>The choice for the graphics was a mix of the 1990s style handheld and home consoles like GameBoy Color and NES games. It wasn‚Äôt meant to mimic any specific game or style, but rather to be reminiscent of the era.</p>\n<img alt=\"Inspirations\" loading=\"lazy\" decoding=\"async\" style=\"aspect-ratio: 1.2260869565217392\" width=\"2115\" height=\"1725\" src=\"https://hypersphere.codes/img/PD2D3sRs6s-2115.webp\">\n<p>I decided to go with 16x16px tiles making up one game unit. Each time on the screen you can see a 10x10 grid which results in a resolution of 160x160px (integer upscaled to look good on modern displays). This results in a more-or-less GameBoy feel, although the original hardware used 8x8px tiles instead and 160√ó144px resolution in total.</p>\n<p>As for the graphics, due to the size limitation, I restrained from adding any sprite maps. Instead, I use downscaled emojis to combine the sprites.</p>\n<img alt=\"Regular emojis rendered in very small sizes can get completely new meanings.\" loading=\"lazy\" decoding=\"async\" style=\"aspect-ratio: 1\" width=\"792\" height=\"792\" src=\"https://hypersphere.codes/img/HEcdLvu56b-792.webp\">\n<p>The image above shows how the player model was built. It uses 4 emojis. Unsurprisingly I used a head emoji for a head with glasses on top, and trousers for a bottom part of a sprite. The torso part is a <a href=\"https://en.wikipedia.org/wiki/Red_envelope\">Red Envelope</a> though, a popular monetary gift in Southeast Asia. Drawn in this resolution it loses all the details and the elongated shape of it is perfect to simulate the body.</p>\n<p>Emojis are not unified across the operating systems, which leads to the interesting effect of game rendering completely different on each OS. You can see the differences in the image below:</p>\n<img alt=\"Different operating systems: Windows, Ubuntu, MacOS\" loading=\"lazy\" decoding=\"async\" style=\"aspect-ratio: 2.0350132625994695\" width=\"3836\" height=\"1885\" src=\"https://hypersphere.codes/img/fwkFVCEbYB-3836.webp\">\n<p>Moreover, not all the systems support the same version of Unicode, making some of the newer emojis not compatible with older systems. In the screenshot above you can see that the tombstone emoji (ü™¶) was replaced with a coffin (‚ö∞Ô∏è) on Windows and Ubuntu ‚Äî <a href=\"https://emojipedia.org/headstone/\">tombstone was introduced in Unicode 13.0</a>. To achieve it I have created a small script rendering each emoji and checking if it was rendered properly. If not, it‚Äôs replaced with its equivalent specified in the handwritten configuration. Because emojis on different systems might have different sizes, some fine-tuning was required too.</p>\n<pre class=\"language-ts\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">OptionalEmojiSet</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// EMOJI</span>\n    e<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// POS</span>\n    pos<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// SIZE</span>\n    size<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> alt<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> OptionalEmojiSet<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"ü™¶\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> e<span class=\"token operator\">:</span> <span class=\"token string\">\"‚ö∞Ô∏è\"</span><span class=\"token punctuation\">,</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> size<span class=\"token operator\">:</span> <span class=\"token number\">.9</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"‚õì\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> e<span class=\"token operator\">:</span> <span class=\"token string\">\"üëñ\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"ü™®\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> e<span class=\"token operator\">:</span> <span class=\"token string\">\"üíÄ\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"ü™µ\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> e<span class=\"token operator\">:</span> <span class=\"token string\">\"üå≥\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"ü¶¥\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> e<span class=\"token operator\">:</span> <span class=\"token string\">\"üíÄ\"</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> win<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> OptionalEmojiSet<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"üî•\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> size<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"üí£\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"üë±\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"üï∂\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> size<span class=\"token operator\">:</span> <span class=\"token number\">1.5</span><span class=\"token punctuation\">,</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"‚¨õÔ∏è\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"üëñ\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"üê∑\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"ü¶ã\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"üêÆ\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"üëî\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"üë©\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"ü§ñ\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"üëö\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"üêµ\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"‚ò¢Ô∏è\"</span><span class=\"token operator\">:</span>  <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">\"üëπ\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> tux<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> OptionalEmojiSet<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">\"üßß\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> e<span class=\"token operator\">:</span> <span class=\"token string\">\"üëî\"</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>To check when each of the emojis was introduced, <a href=\"https://www.unicode.org/emoji/charts/emoji-versions.html\">the following table was a really handy resource</a>.</p>\n<h2 id=\"game-screen-structure\" tabindex=\"-1\">Game Screen Structure <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/gameboy-like-app-in-13k/\">#</a></h2>\n<p>The screen displays 10x10 grid of 16px x 16px tiles making total of 160x160px resolution. Obviously, displaying it directly in such resolution would result in a tiny square on our modern 4k screens ‚Äî that‚Äôs why the image is integer upscaled to the maximum value possible.</p>\n<img alt=\"Game Screen Structure.\" loading=\"lazy\" decoding=\"async\" style=\"aspect-ratio: 1.6164987405541562\" width=\"2567\" height=\"1588\" src=\"https://hypersphere.codes/img/3cdrX0sTmY-2567.webp\">\n<p>To downscale emojis, I used a separate, tiny canvas that kept individual spites rendered in its original 16x16px. Then I can use those sprites to render them to the big destination canvas whenever needed. This allowed me to generate temporary sprite sheets to check if the tiles were properly generated.</p>\n<p>By default, canvas uses image smoothing meaning that when the sprite gets upscaled, it will be smoothened using antialiasing. To avoid that, we need to turn it off.</p>\n<pre class=\"language-ts\" tabindex=\"0\"><code class=\"language-ts\">context<span class=\"token punctuation\">.</span>imageSmoothingEnabled <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></code></pre>\n<h3 id=\"canvas-optimisation\" tabindex=\"-1\">Canvas Optimisation <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/gameboy-like-app-in-13k/\">#</a></h3>\n<p>One of the weird optimization techniques I came across was generating a bitmap from the canvas without saving it. I suspect this marks that portion of the canvas as not changed for future uses and can optimize rendering, but I could not find any definite answer what‚Äôs the exact mechanism that‚Äôs causing it. If you know the answer, please share it in the comments!</p>\n<pre class=\"language-ts\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token function\">createImageBitmap</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">.</span><span class=\"token function\">getImageData</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> ctx<span class=\"token punctuation\">.</span>canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// This makes consecutive rendering faster</span></code></pre>\n<h2 id=\"quadtree\" tabindex=\"-1\">QuadTree <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/gameboy-like-app-in-13k/\">#</a></h2>\n<p>During the game lifecycle, a lot of game objects appear and disappear from the screen. The majority of the game logic revolves around finding which objects are close to each other and detecting collisions or proximity of them ‚Äî every interaction like movement, detecting collisions, enemies following the player, etc; includes logic for finding objects within some distance. The most naive solution for this problem would be to check all objects stored in the memory. Unfortunately, this requires a lot of comparisons. If we would like to perform this action for each of the elements, this would result in having to do O(n¬≤) comparisons every frame.</p>\n<p>With QuadTree, we can do a precomputation to optimize this process. The tree stores our elements in its nodes until the node reaches its capacity. In this scenario, it divides the space into four subspaces (thus the quad in the name). Then, each time we want to find all elements within the given area, we can easily discard objects outside the boundary. The whole process is recursive, so you end up with a structure that is really fast to find elements in.</p>\n<img alt=\"Visual representation of a quad-tree. The space gets divided into four subsections if there are too many items within its boundaries. Green rectangles represent the boundaries of the game objects.\" loading=\"lazy\" decoding=\"async\" style=\"aspect-ratio: 1.092896174863388\" width=\"1200\" height=\"1098\" src=\"https://hypersphere.codes/img/cG8yr5Ofk9-1200.webp\">\n<p>The recursive implementation itself is not too long and can easily fit within 100 lines.</p>\n<pre class=\"language-ts\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> GameObject <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../modules/GameObjects/GameObject\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Rectangle <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../modules/Primitives\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">QuadTree</span> <span class=\"token punctuation\">{</span>\n    objects<span class=\"token operator\">:</span> Set<span class=\"token operator\">&lt;</span>GameObject<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    subtrees<span class=\"token operator\">:</span> QuadTree<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">private</span> _boundary<span class=\"token operator\">:</span> Rectangle<span class=\"token punctuation\">,</span> <span class=\"token keyword\">private</span> limit<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">get</span> <span class=\"token function\">boundary</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_boundary<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">get</span> <span class=\"token function\">subTrees</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>subtrees<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token function\">subdivide</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> p1 <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>boundary<span class=\"token punctuation\">.</span>p1<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> mid <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>boundary<span class=\"token punctuation\">.</span>center<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> w <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>boundary<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">const</span> h <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>boundary<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>subtrees <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">QuadTree</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Rectangle</span><span class=\"token punctuation\">(</span>p1<span class=\"token punctuation\">,</span> mid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>limit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">QuadTree</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Rectangle</span><span class=\"token punctuation\">(</span>p1<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>w<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> mid<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>w<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>limit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">QuadTree</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Rectangle</span><span class=\"token punctuation\">(</span>p1<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> h<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> mid<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> h<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>limit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token keyword\">new</span> <span class=\"token class-name\">QuadTree</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Rectangle</span><span class=\"token punctuation\">(</span>p1<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>w<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> h<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> mid<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>w<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> h<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>limit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        \n        <span class=\"token comment\">// we need to add all exisitng points now</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>o <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>subtrees<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">=></span>\n                t<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">add</span><span class=\"token punctuation\">(</span>obj<span class=\"token operator\">:</span> GameObject<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>boundary<span class=\"token punctuation\">.</span><span class=\"token function\">isIntersectingRectangle</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingBox</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span>size <span class=\"token operator\">+</span> <span class=\"token number\">1</span> <span class=\"token operator\">&lt;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>limit <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>boundary<span class=\"token punctuation\">.</span>width <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>boundary<span class=\"token punctuation\">.</span>height <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>subtrees<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">subdivide</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>subtrees<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>t <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n               t<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">getInArea</span><span class=\"token punctuation\">(</span>boundary<span class=\"token operator\">:</span> Rectangle<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Set<span class=\"token operator\">&lt;</span>GameObject<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>boundary<span class=\"token punctuation\">.</span><span class=\"token function\">isIntersectingRectangle</span><span class=\"token punctuation\">(</span>boundary<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>subtrees<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> s <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set<span class=\"token operator\">&lt;</span>GameObject<span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> tree <span class=\"token keyword\">of</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>subTrees<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                tree<span class=\"token punctuation\">.</span><span class=\"token function\">getInArea</span><span class=\"token punctuation\">(</span>boundary<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>obj <span class=\"token operator\">=></span> s<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> points <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Set<span class=\"token operator\">&lt;</span>GameObject<span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>objects<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>obj <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>boundary<span class=\"token punctuation\">.</span><span class=\"token function\">isIntersectingRectangle</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingBox</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                points<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> points<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<h2 id=\"dithering-effect\" tabindex=\"-1\">Dithering Effect <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/gameboy-like-app-in-13k/\">#</a></h2>\n<img alt=\"Dithering effect.\" loading=\"lazy\" decoding=\"async\" style=\"aspect-ratio: 2.1226666666666665\" width=\"2388\" height=\"1125\" src=\"https://hypersphere.codes/img/PUyIudwzQM-2388.webp\">\n<p>To achieve retro aesthetics instead of varying the opacity of shadows, I resorted to dithering.</p>\n<p>The dithering effect is a technique of mimicking a richer color palette by alternating colors from the smaller set. In the picture above each of the patterns seems to be increasing in brightness even though all of them use just 2 base colors ‚Äî black and purple.</p>\n<p>The effect was commonly used in old consoles and early computer games and applications where the palette was limited. This made developers think outside the box and use techniques like dithering to fake our eyes into thinking there are more colors than actually were displayed on the screen. And maybe most notably GameBoy Camera used ordered dither to display any image captured with it.</p>\n<p>I plan to write a separate article about the effect and some use cases but before that, you can check the code for the effect in the following CodePen:</p>\n<p class=\"codepen\" data-height=\"300\" data-default-tab=\"result\" data-slug-hash=\"OJZJZxY\" data-user=\"hypersphere\" style=\"height: 800px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;\">\n  <span>See the Pen <a href=\"https://codepen.io/hypersphere/pen/OJZJZxY\">\n  Dither</a> by hypersphere (<a href=\"https://codepen.io/hypersphere\">@hypersphere</a>)\n  on <a href=\"https://codepen.io\">CodePen</a>.</span>\n</p>\n<script async=\"\" src=\"https://cpwebassets.codepen.io/assets/embed/ei.js\"></script>\n<h2 id=\"post-processing\" tabindex=\"-1\">Post Processing <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/gameboy-like-app-in-13k/\">#</a></h2>\n<p>Post-processing was an important step in making my game look more realistically retro. The old CRT created very unique artifacts when displaying color images due to the architecture of the display.</p>\n<img alt=\"Photo by ryuuji89 from Please show off what crt shaders can do!\" loading=\"lazy\" decoding=\"async\" style=\"aspect-ratio: 1.356\" width=\"678\" height=\"500\" src=\"https://hypersphere.codes/img/kUgpRapiGM-678.webp\">\n<p>In my attempt to emulate old retro style I overlayed a variation of <a href=\"https://en.wikipedia.org/wiki/Bayer_filter\">Bayers Filter</a> with a slight blur on top of every game pixel and blended it using color-burn blend mode. This made the game have its original style. It, unfortunately, made it way darker but with the main theme around death, it seemed appropriate.</p>\n<img alt=\"Postprocessing\" loading=\"lazy\" decoding=\"async\" style=\"aspect-ratio: 1.4613636363636364\" width=\"2572\" height=\"1760\" src=\"https://hypersphere.codes/img/4wHe5u0V2n-2572.webp\">\n<p>Here‚Äôs the snippet of the code responsible for the effect:</p>\n<pre class=\"language-ts\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token comment\">// drawing on posteffect canvas if it was not done before with slight blur between color \"pixels\"</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>postCanvas<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>postCanvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> m <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>game<span class=\"token punctuation\">.</span><span class=\"token constant\">MULTIPLIER</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>postCanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>postCanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> m<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> ctx <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>postCanvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2d'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>filter <span class=\"token operator\">=</span> <span class=\"token string\">'blur(1px)'</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"red\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span>m<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>  m <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> m<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"green\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> m<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">;</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span>m<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> m<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> m<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> m<span class=\"token operator\">/</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pattern <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span><span class=\"token function\">createPattern</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>postCanvas<span class=\"token punctuation\">,</span> <span class=\"token string\">\"repeat\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token comment\">// blending it using color-burn</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ctx<span class=\"token punctuation\">.</span>globalAlpha <span class=\"token operator\">=</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ctx<span class=\"token punctuation\">.</span>globalCompositeOperation <span class=\"token operator\">=</span> <span class=\"token string\">\"color-burn\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pattern<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// reverting original blend mode.</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ctx<span class=\"token punctuation\">.</span>globalCompositeOperation <span class=\"token operator\">=</span> <span class=\"token string\">\"source-over\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ctx<span class=\"token punctuation\">.</span>globalAlpha <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></code></pre>\n<h2 id=\"audio\" tabindex=\"-1\">Audio <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/gameboy-like-app-in-13k/\">#</a></h2>\n<p>To generate music I‚Äôve used WebAudio API which provides node-based architecture you can use to combine oscillators, filters, effects, and other audio nodes together.</p>\n<img alt=\"Web Audio\" loading=\"lazy\" decoding=\"async\" style=\"aspect-ratio: 2.08955223880597\" width=\"1400\" height=\"670\" src=\"https://hypersphere.codes/img/cfqeE-TQyT-1400.webp\">\n<p>I have <a href=\"https://github.com/h-sphere/gravepassing/blob/main/src/modules/Audio/AudioTrack.ts\">implemented a simple audio tracker</a> that reads predefined music scores and schedules audio. The track can be defined as a string of MIDI notes, encoded as UTF-8 characters:</p>\n<img alt=\"UTF-8 to MIDI converter\" loading=\"lazy\" decoding=\"async\" style=\"aspect-ratio: 1.6614620298083747\" width=\"2341\" height=\"1409\" src=\"https://hypersphere.codes/img/4I8waPiEJJ-2341.webp\">\n<p>A song consists of multiple tracks. They share the same BPM but can have different time divisions defined making it quite easy to iterate on music ideas.</p>\n<p>If you want to learn more about how to use Web Audio, I highly recommend my article about the subject:</p>\n<p><a href=\"https://medium.com/swinginc/playing-with-midi-in-javascript-b6999f2913c3\">Playing with MIDI in JavaScript</a></p>\n<p>and if you want to learn more about MIDI and how to use it in your browser, I recommend the introductory article to my MIDI library written in TypeScript:</p>\n<p><a href=\"https://kulak.medium.com/introducing-midival-f837b2d48185\">Introducing MIDIVal: the easiest way to interact with MIDI in your browser</a></p>\n<h2 id=\"optimizing-package-size\" tabindex=\"-1\">Optimizing package size <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/gameboy-like-app-in-13k/\">#</a></h2>\n<p>Once the game is done, it‚Äôs time for compression. My main goal was not to constrain myself when writing code, to be able to use object-oriented programming with proper class names, and defer the minification to a separate step. Thanks to that majority of the code stayed readable (I only had to manually change a handful of things) and still minifies well.</p>\n<p>The limit is exactly 13312b (13 * 1024) and my package without compression was initially around 14500b. That‚Äôs 1.5kb of compressed code to shave.</p>\n<p>I‚Äôve started by incorporating uglify in the build flow which mostly removed some console.logs and shorten some names. I played a bit with parameters but it didn‚Äôt do a great job of replacing the names of my classes and methods. I decided to go with a custom solution.</p>\n<h2 id=\"codemod-for-typescript\" tabindex=\"-1\">Codemod for TypeScript <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/gameboy-like-app-in-13k/\">#</a></h2>\n<p>Fortunately, the whole codebase was written in TypeScript. Thanks to that I could easily rename the majority of the class names, properties, and functions using a simple codemod written with the help of ts-morph.</p>\n<p><a href=\"https://ts-morph.com/\">TS-morph</a> is a simple tool helping with navigating the TypeScript AST tree. Instead of having to manually navigate through the nodes, you can easily extract all the symbols from the file and change them in all places automatically.</p>\n<pre class=\"language-ts\" tabindex=\"0\"><code class=\"language-ts\"><span class=\"token keyword\">let</span> name <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">65</span><span class=\"token punctuation\">,</span> <span class=\"token number\">65</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token function-variable function\">generateNextName</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">===</span> <span class=\"token number\">90</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    name<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    name<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">65</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  name<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">nameString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nclasses<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> name <span class=\"token operator\">=</span> i<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> nextName <span class=\"token operator\">=</span> <span class=\"token function\">generateNextName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">===</span> nextName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// Rename class</span>\n    <span class=\"token class-name\"><span class=\"token builtin\">console</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token string\">'->'</span><span class=\"token punctuation\">,</span> nextName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    i<span class=\"token punctuation\">.</span><span class=\"token function\">rename</span><span class=\"token punctuation\">(</span>nextName<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      renameInComments<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      renameInStrings<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>The code above renames all class names into <code>AA</code> , <code>AB</code> , <code>AC</code> and so on. Because we use typed language, we know where the class is used so all usages are automatically renamed as well. The same was done to class methods and properties. <a href=\"https://github.com/h-sphere/gravepassing/blob/main/scripts/rename-classes.ts\">Here‚Äôs my full codemod</a>.</p>\n<h3 id=\"roadroller\" tabindex=\"-1\">Roadroller <a class=\"header-anchor\" href=\"https://hypersphere.codes/blog/gameboy-like-app-in-13k/\">#</a></h3>\n<p>To reduce the size even further I used <a href=\"https://lifthrasiir.github.io/roadroller/\">roadroller</a>. It is a tool that flattens JavaScript by using complex compression techniques like bytewise rANS coder, making the source code completely unreadable but very efficient. It shaved a few kb of my code making my bundle fit the limit with no problem.</p>\n<p>What do you think of the solutions? What would you add or improve in my entry? Put your thoughts down in the comments!</p>\n",
			"date_published": "2022-10-10T00:00:00Z"
		}
		
	]
}
